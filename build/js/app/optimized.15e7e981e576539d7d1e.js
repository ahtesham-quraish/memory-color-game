function Card(a){this.color=a,this.state=!1}function shuffle(a){var b=0,c=0,d=null;for(b=a.length-1;b>0;b-=1)c=Math.floor(Math.random()*(b+1)),d=a[b],a[b]=a[c],a[c]=d;return a}function Game(a){function b(a,b){for(var c=void 0,d=void 0,e=0;e<a.length;e++)a[e].color===b&&(c?d=e:c=e);c+1===d?a.splice(c,2):(a.splice(c,1),a.splice(d-1,1))}function c(a){var b=new Date,c=null;do c=new Date;while(a>c-b)}this.pairs=8;var d=createPackCards(a);this.grid=shuffle(d),this.score=0,this.color="nothing",this.flipCard=function(a){if(!a.state)if(a.flip(),!this.firstcard||this.secondcard)this.secondcard&&(this.firstcard.flip(),this.secondcard.flip(),this.firstcard=void 0,this.secondcard=void 0,this.score--),this.firstcard=a;else{if(this.firstcard.color==a.color)return c(500),this.firstcard=void 0,this.secondcard=void 0,this.score++,this.pairs--,this.color=a.color,void b(this.grid,a.color);this.secondcard=a}}}Card.prototype.flip=function(){this.state=!this.state},createPackCards=function(a){var b=[];return a.forEach(function(a){b.push(new Card(a)),b.push(new Card(a))}),b},angular.module("arrowSelector",[]).directive("arrowSelector",["$document",function(a){return{restrict:"A",link:function(b,c,d,e){var f=!1;a.bind("keydown",function(a){if(!f){if(37==a.keyCode){if(0==b.selectedRow)return;b.selectedRow--,b.$apply(),a.preventDefault()}if(38==a.keyCode){if(0==b.selectedRow||b.selectedRow<4)return;b.selectedRow=b.selectedRow-4,b.$apply(),a.preventDefault()}if(39==a.keyCode){if(b.selectedRow==b.game.grid.length-1)return;b.selectedRow++,b.$apply(),a.preventDefault()}if(40==a.keyCode){if(b.selectedRow+4>=b.game.grid.length)return;b.selectedRow=b.selectedRow+4,b.$apply(),a.preventDefault()}13==a.keyCode&&(b.game.flipCard(b.game.grid[b.selectedRow]),b.$apply(),a.preventDefault())}})}}}]),angular.module("finalResult",[]).directive("finalResult",[function(){var a={};return a.restrict="E",a.templateUrl="partials/result.html",a.link=function(a,b,c){},a}]),angular.module("modalDialog",["GameService"]).directive("modalDialog",["GameService",function(a){return{restrict:"EA",scope:{show:"="},link:function(b,c,d){b.submitForm=function(){b.$parent.submitForm()},b.submitForm=function(){if(""!=b.username1&&""!=b.email1){var c={name:b.username1,email:b.email1,score:b.$parent.game.score};b.$parent.modalShown=!1,a.saveResult(c).then(function(a){b.$parent.yourrank=a.yourranking,b.$parent.topScorer=a.topScorer,b.$parent.result=!0},function(a){console.log(a)})}},b.dialogStyle={},d.width&&(b.dialogStyle.width=d.width),d.height&&(b.dialogStyle.height=d.height),b.hideModal=function(){b.show=!1}},templateUrl:"partials/modal.html"}}]),angular.module("GameContr",["GameService"]).controller("GameContr",["$scope","game","GameService",function(a,b,c){a.game=b.game(),a.selectedRow=0,a.board=!0,a.user=!1,a.username1="",a.email1="",a.topScorer=[],a.modalShown=!1,a.hideModal=function(){a.modalShown=!a.modalShown},a.StartAgain=function(){a.game=b.game(),a.selectedRow=0,a.board=!0,a.user=!1,a.name="",a.email="",a.result=!1,a.topscore=0,a.yourrank=0,a.topscore=0,a.yourrank=0,a.result=!1},a.$watch("game.pairs",function(){a.selectedRow>=a.game.grid.length&&(a.selectedRow=0),0==a.game.pairs&&(a.board=!1,a.user=!0,a.modalShown=!0)})}]),angular.module("GameService",[]).service("GameService",["$http","$q",function(a,b){function c(b){console.log(JSON.stringify(b));var c=a({method:"post",url:"index.php/addresult",data:JSON.stringify(b)});return c.then(e,d)}function d(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function e(a){return angular.fromJson(a.data)}return{saveResult:c}}]);var gameApp=angular.module("gameApp",["GameContr","GameService","arrowSelector","finalResult","modalDialog"]);gameApp.factory("game",function(){var a=["Red","Green","Blue","Pink","Ornage","White","Yellow","Purple"];return{game:function(){return new Game(a)}}});